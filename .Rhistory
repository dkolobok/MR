filt_res <- mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id)
head(filt_res)
filt_res[1, ]
filt_res[1, ]
filt_res[1, 'exposure']
print(glue("{filt_res[1, 'exposure']} against {filt_res[1, 'outcome']}"))
library(glue)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/Downloads/prot_vs_prolapse_filtered.csv')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv')
View(indf)
exp_ids <- c('prot-b-83', 'prot-b-11')
out_ids <- c('ukb-a-577', 'ukb-a-92')
mrres <- perform_mr(exp_ids = exp_ids,
out_ids = out_ids)
View(mrres$dat)
dim(mrres$dat)
mrres$dat %>% tally()
mrres$dat %>% count()
mrres$dat %>% n_distinct()
mrres$dat %>% select(SNP) %>% n_distinct()
names(mrres$dat)
View(indf)
length(indf$id.exposure)
length(unique(indf$id.exposure))
names(indf)
length(indf)
dim(indf)
dim(indf %>% select_('id.exposure', 'id.outcome',
'Gene', 'Chromosome',
'Gene.start..bp.', 'Gene.end..bp.',
"Strand", "Band", "Function")
%>% distinct())
dim(indf %>% distinct())
indf %>% select(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
)
%>% distinct()
indf %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
)))
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv')
names(indf)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv') %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct()
View(indf)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv') %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
)))
dim(indf %>% distinct())
dim(indf %>% distinct() %>% na.omit())
names(read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv'))
?read.csv
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
)))
dim(indf %>% distinct())
dim(indf %>% distinct() %>% na.omit())
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct()
View(indf)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% na.omit('Gene.start..bp.')
dim(indf)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% na.omit(get('Gene.start..bp.'))
dim(indf)
?na.omit
? drop_na
?drop_na
?dplyr::drop_na
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na(get('Gene.start..bp.'))
library(dplyr)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na(get('Gene.start..bp.'))
library(dplyr)
??drop_na
library(tidyr)
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na(get('Gene.start..bp.'))
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
dim(indf)
length((indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique())
length((indf)$id.exposure %>% unique())
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
dim(indf)
dim(indf %>% filter(id.exposure %in% valid_exp))
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
exp_dat <- extract_instruments(outcomes = exp_ids)
out_dat <-
extract_outcome_data(snps = exp_dat$SNP, outcomes = out_ids)
dat <- harmonise_data(exp_dat, out_dat)
dim(dat)
dim(dat %>% inner_join(indf,
by = c(id.exposure, id.outcome)))
names(indf)
names(dat)
dim(dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
)
dim(dat)
names(dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
)
dat <- dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
dat <- dat %>% mutate(label = paste(chr, pos, sep = ":"))
dat %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(Gene, Chromosome, Gene.start..bp., Gene.end..bp., Strand, Band, Function)
exp_id <- dat$id.exposure[1]
out_id <- dat$id.outcome[1]
View(dat %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(Gene, Chromosome, Gene.start..bp., Gene.end..bp., Strand, Band, Function))
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
indf <- indf %>% filter(id.exposure == 'prot-a-972') %>% filter(id.outcome == 'finn-a-N14_FEMGENPROL')
indf
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
exp_dat <- extract_instruments(outcomes = exp_ids)
out_dat <-
extract_outcome_data(snps = exp_dat$SNP, outcomes = out_ids)
dat <- harmonise_data(exp_dat, out_dat)
# leave only pairs present in indf
dat <- dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
dat <- dat %>% mutate(label = paste(chr, pos, sep = ":"))
dat
res <- mr(dat)
res
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
indf
View(indf)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
# exp_ids <- c('prot-b-83', 'prot-b-11')
# out_ids <- c('ukb-a-577', 'ukb-a-92')
mrres <-
perform_mr(
indf = indf
)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
mrres <-
perform_mr(
indf = indf
)
pdf("c:/users/dkolobok/Documents/report.pdf")
for (exp_id in mrres$res$id.exposure %>% unique())
for (out_id in mrres$res$id.outcome %>% unique()) {
filt_res <- mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id)
message(glue("{filt_res[1, 'exposure']} VS {filt_res[1, 'outcome']}"))
print(glue("{filt_res[1, 'exposure']} VS {filt_res[1, 'outcome']}"))
print(knitr::kable(mrres$dat %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(Gene, Chromosome, Gene.start..bp., Gene.end..bp., Strand, Band, Function) %>% distinct()))
print("MR results: \n")
print(knitr::kable(mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(id.exposure, id.outcome, method, nsnp, b, pval)))
plot(mrres$p[[glue("{exp_id}.{out_id}")]])
}
filt_res
exp_id
out_id
filt_res <- mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id)
filt_res
dim(mrres$res)
pairs <- mrres$res %>% select(id.exposure, id.outcome) %>% distinct()
i=1
dev.off()
pdf("c:/users/dkolobok/Documents/report.pdf")
exp_id <- pairs[i, 'id.exposure']
out_id <- pairs[i, 'id.outcome']
filt_res <- mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id)
message(glue("{filt_res[1, 'exposure']} VS {filt_res[1, 'outcome']}"))
print(glue("{filt_res[1, 'exposure']} VS {filt_res[1, 'outcome']}"))
print(knitr::kable(mrres$dat %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(Gene, Chromosome, Gene.start..bp., Gene.end..bp., Strand, Band, Function) %>% distinct()))
print("MR results: \n")
print(knitr::kable(mrres$res %>% filter(id.exposure == exp_id, id.outcome == out_id) %>% select(id.exposure, id.outcome, method, nsnp, b, pval)))
plot(mrres$p[[glue("{exp_id}.{out_id}")]])
dev.off()
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
exp_dat <- extract_instruments(outcomes = exp_ids)
out_dat <-
extract_outcome_data(snps = exp_dat$SNP, outcomes = out_ids)
dat <- harmonise_data(exp_dat, out_dat)
# leave only pairs present in indf
dat <- dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
dat <- dat %>% mutate(label = paste(chr, pos, sep = ":"))
View(dat)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% sum()
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% sum(na.rm = True)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% sum(na.rm = TRUE)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% tally()
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% count()
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% dplyr::count()
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% dplyr::count(sprt=TRUE)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% dplyr::count(sort=TRUE)
dat %>% mutate(is_proxy=target_snp.outcome==proxy_snp.outcome) %>% dplyr::count(is_proxy)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
exp_dat <- extract_instruments(outcomes = exp_ids)
out_dat <-
extract_outcome_data(snps = exp_dat$SNP, outcomes = out_ids)
dat <- harmonise_data(exp_dat, out_dat)
# leave only pairs present in indf
dat <- dat %>% inner_join(indf,
by = c('id.exposure', 'id.outcome'))
dat <- dat %>% mutate(label = paste(chr, pos, sep = ":"))
delta=100000
names(dat)
dat %>% filter((chr == Chromosome) & (Gene.start..bp. + delta <= pos))
names(dat)
nrow(dat)
nrow(dat %>% filter((chr == Chromosome) & (Gene.start..bp. - delta <= pos) & (Gene.end..bp. + delta >= pos)))
# cis-MR: leave only SNPs with gene boundaries +- delta
dat <- dat %>% filter((chr == Chromosome) & (Gene.start..bp. - delta <= pos) & (Gene.end..bp. + delta >= pos))
View(dat %>% select(chr, Chromosome, Gene.start..bp., Gene.end..bp.))
View(dat %>% select(chr, Chromosome, pos, Gene.start..bp., Gene.end..bp.))
exp_dat <- extract_instruments(outcomes = exp_ids, p1=pval, p2=pval)
pval=5e-5
exp_dat <- extract_instruments(outcomes = exp_ids, p1=pval, p2=pval)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids, p1=pval, p2=pval)
)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids, p1=pval, p2=pval)
)
pval=5e-7, delta=100000
pval=5e-7
delta=100000
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids, p1=pval, p2=pval)
)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids,
p1=pval, p2=pval,
force_server=TRUE)
)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
exp_ids <- unique(indf$id.exposure)
out_ids <- unique(indf$id.outcome)
pval=5e-7
delta=100000
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids)
)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids,p1=1e-8, p2=1e-8)
)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids,
p1=5e-8, p2=5e-8)
)
system.time(
exp_dat <- extract_instruments(outcomes = exp_ids,
p1=6e-8, p2=6e-8)
)
library(glue)
library(tidyr)
library(ggplot2)
source('ind_mr_fun.R')
indf <- read.csv('c:/users/dkolobok/Downloads/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% distinct() %>% drop_na('Gene.start..bp.')
# select exposures for which 'finn...' outcomes are present
valid_exp <- (indf %>% filter(stringr::str_detect(id.outcome, 'finn')))$id.exposure %>% unique()
indf <- indf %>% filter(id.exposure %in% valid_exp)
# exp_ids <- c('prot-b-83', 'prot-b-11')
# out_ids <- c('ukb-a-577', 'ukb-a-92')
