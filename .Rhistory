install.packages('devtools')
devtools::install_github("MRCIEU/TwoSampleMR")
devtools::install_github("MRCIEU/TwoSampleMR")
install.packages('ieugwasr')
devtools::install_github("MRCIEU/TwoSampleMR")
remove.packages("rlang")
install.packages('rlang')
install.packages("rlang")
devtools::install_github("MRCIEU/TwoSampleMR")
devtools::install_github("MRCIEU/TwoSampleMR")
install.packages('devtools')
devtools::install_github("MRCIEU/TwoSampleMR")
devtools::install_github("MRCIEU/TwoSampleMR")
devtools::install_github("MRCIEU/TwoSampleMR")
devtools::install_github("MRCIEU/TwoSampleMR")
install.packages('plotly')
install.packages('dplyr')
update.packages()
update.packages(ask=FALSE)
install_github("MRCIEU/TwoSampleMR")
library(devtools)
install_github("MRCIEU/TwoSampleMR")
library(devtools)
install_github("MRCIEU/TwoSampleMR")
library(devtools)
install_github("MRCIEU/TwoSampleMR")
library(TwoSampleMR)
library(MRInstruments)
data(gwas_catalog)
head(gwas_catalog)
gwas_catalog$Phenotype_info
gwas_catalog$Phenotype_simple
gwas_catalog$Phenotype
gwas_catalog$names
names(gwas_catalog)
exposure_df <- gwas_catalog %>% filter(grepl("immun", Phenotype_simple) |
grepl("immun", Phenotype) |
grepl("immun", Phenotype_info))
exposure_df <- gwas_catalog %>% filter(grepl("immun", Phenotype) |
grepl("immun", Phenotype_info))
gwas_catalog
names(gwas_catalog)
library(tidyverse)
library(dplyr)
exposure_df <- gwas_catalog %>% filter(stringr::str_detect(Phenotype_simple, 'immun') |
stringr::str_detect(Phenotype, 'immun') |
stringr::str_detect(Phenotype_info, 'immun'))
dim(exposure_df)
exposure_df
exposure_df[1,]
outcome_df <- available_outcomes()
dim(exposure_df)
length(unique(exposure_df$Phenotype_simple))
gwas_catalog %>% filter(Phenotype_simple="ieu-a-2")
gwas_catalog %>% filter(Phenotype_simple=="ieu-a-2")
extract_instruments("ieu-a-2")
# Get instruments
exposure_dat <- extract_instruments("ieu-a-2")
exposure_dat
exposure_dat[1,]
View(outcome_df)
ao <- available_outcomes()
ao[grepl("heart disease", ao$trait), ]
names(ao)
dim(ao)
length(unique(ao$id))
length(unique(ao$trait))
dim(ao[grepl("immun", ao$trait), ])
dim(ao[grepl("pneumon", ao$trait), ])
dim(ao[grepl("pneumon", ao$trait)|grepl("covid", ao$trait), ])
outcome_ids<- available_outcomes()[grepl("pneumon", ao$trait)|grepl("covid", ao$trait), 'id']
outcome_ids
# Get effects of instruments on outcome
outcome_dat <- extract_outcome_data(snps=exposure_df$SNP, outcomes=outcome_ids)
exposure_df$SNP
outcome_ids
outcome_ids[1]
outcome_ids<- available_outcomes()[grepl("pneumon", ao$trait)|grepl("covid", ao$trait), ]$id
outcome_ids
# Get effects of instruments on outcome
outcome_dat <- extract_outcome_data(snps=exposure_df$SNP, outcomes=outcome_ids)
debugSource('C:/Users/dkolobok/code/MR/main.R')
debugSource('C:/Users/dkolobok/code/MR/main.R')
debugSource('C:/Users/dkolobok/code/MR/main.R')
available_outcomes() %>% filter(stringr::str_detect(trait, 'immun|covid'))
ao <- available_outcomes() %>% filter(stringr::str_detect(trait, 'pneumon|covid'))
dim(ao)
debugSource('C:/Users/dkolobok/code/MR/main.R')
debugSource('C:/Users/dkolobok/code/MR/main.R')
debugSource('C:/Users/dkolobok/code/MR/main.R')
harmonise_data(exposure_df, outcome_dat)
outcome_dat
# exposure_df <- gwas_catalog %>% filter(stringr::str_detect(Phenotype_simple, 'immun') |
#                                        stringr::str_detect(Phenotype, 'immun') |
#                                        stringr::str_detect(Phenotype_info, 'immun'))
ao <- available_outcomes()
exit
exit()
q()
q
q
q
quit()
quit
ao <- available_outcomes()
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid'))
exposure_df <- ao %>% filter(stringr::str_detect(trait, 'immun'))
debugSource('C:/Users/dkolobok/code/MR/main.R')
res
ao
ao
debugSource('C:/Users/dkolobok/code/MR/main.R')
debugSource('C:/Users/dkolobok/code/MR/main.R')
res
dim(res)
class(res)
dim(res %>% filter(nsnp >= 3))
dim(res %>% filter(nsnp >= 3 & pval < 0.05))
res %>% filter(nsnp >= 3 & pval < 0.05)
View(res %>% filter(nsnp >= 3 & pval < 0.05))
names(res)
res %>% filter(nsnp >= 3 & pval < 0.05) %>% group_by(id.exposure, id.outcome) %>% count()
res %>% filter(nsnp >= 3 & pval < 0.05) %>% tally(method)
res %>% filter(nsnp >= 3 & pval < 0.05) %>% count(method)
debugSource('C:/Users/dkolobok/code/MR/main.R')
res
res %>% filter(nsnp >= 3 & pval < 0.05)
View(res %>% filter(nsnp >= 3 & pval < 0.05))
dim(outcome_df)
dim(exposure_df)
head(exposure_df)
dim(ao)
dim(res)
names(res)
dim(res %>% select(id.exposure, id.outcome) %>% distinct())
dim(res)
dim(res %>% filter(nsnp >= 3 & pval < 0.05))
tmp <- res %>% filter(nsnp >= 3 & pval < 0.05)
dim(tmp %>% select(id.exposure, id.outcome) %>% distinct())
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid')), 2)
outcome_df
debugSource('C:/Users/dkolobok/code/MR/main.R')
library(TwoSampleMR)
library(MRInstruments)
library(dplyr)
library(tidyverse)
data(gwas_catalog)
# exposure_df <- gwas_catalog %>% filter(stringr::str_detect(Phenotype_simple, 'immun') |
#                                        stringr::str_detect(Phenotype, 'immun') |
#                                        stringr::str_detect(Phenotype_info, 'immun'))
ao <- available_outcomes()
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid')), 2)
exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
})
library(TwoSampleMR)
library(MRInstruments)
library(dplyr)
library(tidyverse)
data(gwas_catalog)
# exposure_df <- gwas_catalog %>% filter(stringr::str_detect(Phenotype_simple, 'immun') |
#                                        stringr::str_detect(Phenotype, 'immun') |
#                                        stringr::str_detect(Phenotype_info, 'immun'))
ao <- available_outcomes()
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid')), 2)
exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
het<-mr_heterogeneity(dat)
plt<-mr_pleiotropy_test(dat)
sin<-mr_singlesnp(dat)
all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
het
plt
sin
all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
res
exposure_dat
exposure_df
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
exposure_df
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat
head(ao)
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')), 2)
# exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
exposure_df <- head(ao)
len(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')))
dim(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')))
dims(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')))
ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
outcome_df[[1]]
ao <- available_outcomes()
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')), 2)
# exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
exposure_df <- head(ao, 2)
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
het<-mr_heterogeneity(dat)
plt<-mr_pleiotropy_test(dat)
sin<-mr_singlesnp(dat)
all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
debugSource('C:/Users/dkolobok/code/MR/main.R')
sin
combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
combine_all_mrresults(res,het,plt,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
combine_all_mrresults(res,het,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
combine_all_mrresults(res,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
combine_all_mrresults(res,het)
res
het
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
# het<-mr_heterogeneity(dat)
# plt<-mr_pleiotropy_test(dat)
# sin<-mr_singlesnp(dat)
# all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
# het<-mr_heterogeneity(dat)
# plt<-mr_pleiotropy_test(dat)
# sin<-mr_singlesnp(dat)
# all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')), 1)
# exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
exposure_df <- head(ao, 1)
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
# het<-mr_heterogeneity(dat)
# plt<-mr_pleiotropy_test(dat)
# sin<-mr_singlesnp(dat)
# all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
ao <- available_outcomes()
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')), 5)
# exposure_df <- head(ao %>% filter(stringr::str_detect(trait, 'immun')))
exposure_df <- head(ao, 10)
system.time({
exposure_dat <- extract_instruments(outcomes=exposure_df$id)
exposure_dat <- clump_data(exposure_dat)
exposure_dat %>% select(id.exposure) %>% distinct() %>% dim()
outcome_dat <- extract_outcome_data(snps=exposure_dat$SNP, outcomes=outcome_df$id,
proxies = 1, rsq = 0.8, align_alleles = 1,
palindromes = 1, maf_threshold = 0.3)
dat <- harmonise_data(exposure_dat, outcome_dat, action = 2)
res <- mr(dat)
# het<-mr_heterogeneity(dat)
# plt<-mr_pleiotropy_test(dat)
# sin<-mr_singlesnp(dat)
# all_res<-combine_all_mrresults(res,het,plt,sin,ao_slc=T,Exp=T,split.exposure=F,split.outcome=T)
})
dim(ao)
length(ao)
nrows(ao)
nrow(ao)
nrow(ao) * nrow(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')) / 50 * 284.13 / 3600
nrow(ao) * nrow(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')) / 50 * 284.13
nrow(ao) * nrow(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))) / 50 * 284.13
nrow(ao) * nrow(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))) / 50 * 284.13 / 3600
library(TwoSampleMR)
library(MRInstruments)
library(dplyr)
library(tidyverse)
# data(gwas_catalog)
# exposure_df <- gwas_catalog %>% filter(stringr::str_detect(Phenotype_simple, 'immun') |
#                                        stringr::str_detect(Phenotype, 'immun') |
#                                        stringr::str_detect(Phenotype_info, 'immun'))
ao <- available_outcomes()
