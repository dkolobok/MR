source('get_input.R')
source('ind_mr.R')
source('bulk_mr.R')
ieugwasr::get_access_token()
res <- bulk_mr(indf)
vars
indf
exp_df <- indf %>%
dplyr::select(id.exposure, Chromosome, Gene.start..bp., Gene.end..bp., Gene, Strand, Band, Function) %>%
distinct() #%>% head(2)
exp_df <- exp_df %>% filter(id.exposure == 'prot-a-1530')
exp_df
row <- exp_df
exp_id <- row$id.exposure
chr <- row$Chromosome
start <- row$Gene.start..bp.
end <- row$Gene.end..bp.
log_info(glue("Processing exposure id {exp_id}"))
counter <- 0
exp_id <- row$id.exposure
chr <- row$Chromosome
start <- row$Gene.start..bp.
end <- row$Gene.end..bp.
log_info(glue("Processing exposure id {exp_id}"))
counter <- 0
while (counter < 3) {
try(vars <- ieugwasr::associations(variants=glue("{chr}:{start-delta}-{end+delta}"),
id=exp_id))
if (is.data.frame(vars)) break
counter <- counter + 1
}
if (counter == 3) {
log_info("Three unsuccessful attempts to get data (most likely too many variants to access or connection problems). Ignoring this exposure.")
return()
}
delta=100000
pval=1e-5
pval_threshold=1e-5
exp_id <- row$id.exposure
chr <- row$Chromosome
start <- row$Gene.start..bp.
end <- row$Gene.end..bp.
log_info(glue("Processing exposure id {exp_id}"))
counter <- 0
while (counter < 3) {
try(vars <- ieugwasr::associations(variants=glue("{chr}:{start-delta}-{end+delta}"),
id=exp_id))
if (is.data.frame(vars)) break
counter <- counter + 1
}
if (counter == 3) {
log_info("Three unsuccessful attempts to get data (most likely too many variants to access or connection problems). Ignoring this exposure.")
return()
}
ntotal_vars <- nrow(vars)
vars
vars <- ieugwasr::associations(variants=glue("{chr}:{start-delta}-{end+delta}"),
id=exp_id)
vars
((counter == 3) or (nrow(vars) == 0))
((counter == 3) | (nrow(vars) == 0))
source("~/code/MR/tmp.R")
library(glue)
library(tidyr)
library(purrrlyr)
source('ind_mr.R')
source('plot_scatter.R')
source('get_input.R')
source('ind_mr.R')
source('bulk_mr.R')
ieugwasr::get_access_token()
res <- bulk_mr(indf)
dim(res$res)
View(res$res)
View(res$res %>% filter(method = 'Inverse variance weighted'))
View(res$res %>% filter(method == 'Inverse variance weighted'))
View(res$res %>% filter(method == 'Inverse variance weighted') %>% dplyr::select(exposure, nsnp, b, pval))
res$res %>% filter(method == 'Inverse variance weighted') %>% dplyr::select(exposure) %>% head(10)
write.csv(res$res %>% filter(method == 'Inverse variance weighted') %>% dplyr::select(exposure) %>% head(10), '~/Downloads/top_exposures.csv', row.names = FALSE)
res$res %>% filter(method == 'Inverse variance weighted') %>% arrange(pval) %>% dplyr::select(exposure) %>% head(10)
View(res$res %>% filter(method == 'Inverse variance weighted') %>% arrange(pval))
write.csv(res$res %>% filter(method == 'Inverse variance weighted') %>% dplyr::select(exposure) %>% head(10), '~/Downloads/top_exposures.csv', row.names = FALSE)
(res$res %>% filter(method == 'Inverse variance weighted') %>% arrange(pval))$id.exposure %>% head(10)
write.csv(res$res %>% filter(method == 'Inverse variance weighted') %>% arrange(pval) %>% dplyr::select(exposure) %>% head(10), '~/Downloads/top_exposures.csv', row.names = FALSE)
ao <- available_outcomes()
write.csv(ao, file='/home/dkolobok/code/MR/data/mr_available_outcomes.csv')
# ao <- available_outcomes()
# write.csv(ao, file='/home/dkolobok/code/MR/data/mr_available_outcomes.csv')
ao <- read.csv('/home/dkolobok/code/MR/data/mr_available_outcomes.csv')
ao
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')), 1)
outcome_df
dim(outcome_df)
dim(ao)
View(ao)
outcome_df <- head(ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
View(outcome_df)
View(ao)
ao[2,]
library(glue)
library(tidyr)
library(purrrlyr)
library(tidyr)
indf <- read.csv('/home/dkolobok/code/MR/data/prot_vs_prolapse_filtered.csv', na.strings = c('.')) %>% dplyr::select(one_of(c(
'id.exposure',
'id.outcome',
'Gene',
'Chromosome',
'Gene.start..bp.',
'Gene.end..bp.',
"Strand",
"Band",
"Function"
))) %>% dplyr::distinct() %>% drop_na('Gene.start..bp.')
# top exposures
top_exp <- c("prot-a-2908", "prot-a-607",  "prot-a-1445", "prot-a-545",
"prot-a-1154", "prot-a-1305", "prot-a-96", "prot-a-2397",
"prot-a-1369", "prot-a-2243")
indf <- indf %>% filter(id.exposure %in% top_exp)
indf
indf <- indf %>% dplyr::filter(id.exposure %in% top_exp)
View(indf)
indf <- read.csv('/home/dkolobok/code/MR/data/prot_vs_prolapse_filtered.csv', na.strings = c('.'))
indf <- indf %>% dplyr::distinct() %>% drop_na('Gene.start..bp.') %>% dplyr::filter(id.exposure %in% top_exp)
View(indf)
library(glue)
library(tidyverse)
library(purrrlyr)
library(mygene)
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by "sed 's/;.*//'" (delete everything after ;)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait')
out <- queryMany(exposure_df$preferred_name %>% head(), scopes=c("symbol"),
fields=c("uniprot"), species="human")
out
?queryMany
out <- queryMany(exposure_df$preferred_name %>% head(), scopes=c("symbol"),
fields="all", species="human")
View(out)
class(out)
out
out[1,]
names(out)
out <- queryMany(exposure_df$preferred_name %>% head(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human")
out
exposure_df %>% head(4)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% rename(symbol=preferred_name)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% dplyr::rename(symbol=preferred_name)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human") %>% dplyr::rename(symbol=query)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human")
dim(gene_coord)
class(gene_coord)
dir(gene_coord)
length(gene_coord)
gene_coord
suumary(gene_coord)
summary(gene_coord)
gene_coord[-1]
class(gene_coord[-1])
class(gene_coord[[-1]])
names(gene_coord)
class(gene_coord$hits)
dim(gene_coord$hits)
gene_coord$hits
names(gene_coord$hits)
View(gene_coord$hits)
View((gene_coord$hits)[[3]][[1]])
View((gene_coord$hits)[[3]][[2]])
library(glue)
library(tidyverse)
library(purrrlyr)
library(mygene)
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by "sed 's/;.*//'" (delete everything after ;)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% dplyr::rename(symbol=preferred_name)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human")
# %>% dplyr::rename(symbol=query)
exposure_df <- exposure_df %>% inner_join(string_db, by='trait')
gene_coord <- queryMany(exposure_df$preferred_name %>% unique() %>% head(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human")
class(gene_coord)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos"), species="human")
class(gene_coord)
dim(gene_coord)
View(gene_coord)
head(gene_coord)
gene_coord[1,]
gene_coord[1,]$genomic_pos
gene_coord <- queryMany(exposure_df$preferred_name %>% unique() %>% head(), scopes=c("symbol"),
fields=c("genomic_pos.chr"), species="human")
gene_coord
gene_coord <- queryMany(exposure_df$preferred_name %>% unique() %>% head(), scopes=c("symbol"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end", "genomic_pos.strand"), species="human")
gene_coord
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
head(gene_coord)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique() %>% head(), scopes=c("symbol"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord
?queryMany
gene_coord <- query(exposure_df$preferred_name %>% unique() %>% head(), scopes=c("symbol"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
exposure_df %>% head()
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by "sed 's/;.*//'" (delete everything after ;)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
head(exposure_df)
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% dplyr::rename(symbol=preferred_name)
head(exposure_df)
head(string_db)
# the original string database table can be processed by
# "sed 's/;.*//'" (delete everything after ;)
# and ""
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by
# sed 's/;.*//; s/9606.//' 9606.protein.info.v11.0.txt > stringdb.txt
# (delete everything after ; and delete '9606.' prefix)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% dplyr::rename(symbol=preferred_name)
gene_coord <- queryMany(exposure_df$preferred_name %>% unique(), scopes=c("symbol"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
# %>% dplyr::rename(symbol=query)
exposure_df <- exposure_df %>% inner_join(string_db, by='trait')
rm(list=ls())
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by
# sed 's/;.*//; s/9606.//' 9606.protein.info.v11.0.txt > stringdb.txt
# (delete everything after ; and delete '9606.' prefix)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-'))
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='trait') %>% dplyr::rename(symbol=preferred_name)
head()
head(exposure_df)
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique(), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
# %>% dplyr::rename(symbol=query)
head(gene_coord)
queryMany(exposure_df$protein_external_id %>% unique() %>% head(100), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(50), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(20), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(30), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(40), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(45), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(42), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(43), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% head()
queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% tail()
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(50), scopes=c("ensembl.protein"),
fields=c("genomic_pos", species="human") %>% head()
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(50), scopes=c("ensembl.protein"),
fields=c("genomic_pos"), species="human")
gene_coord
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord %>% tail()
gene_coord[44, 'genomic_pos']
tmp <- unnest_auto(gene_coord)
tmp <- unnest_auto(gene_coord, col = 'genomic_pos')
tmp <- unnest_longer(gene_coord, col = 'genomic_pos')
df <- tibble(
character = c("Toothless", "Dory"),
metadata = list(
list(
species = "dragon",
color = "black",
films = c(
"How to Train Your Dragon",
"How to Train Your Dragon 2",
"How to Train Your Dragon: The Hidden World"
)
),
list(
species = "blue tang",
color = "blue",
films = c("Finding Nemo", "Finding Dory")
)
)
)
df
df[1, 'metadata']
df[1, 'metadata'][[1]]
tmp <- unnest_longer(as.tibble(gene_coord), col = 'genomic_pos')
tmp <- unnest_longer(as_tibble(gene_coord), col = 'genomic_pos')
tmp <- unnest_auto(as_tibble(gene_coord), col = 'genomic_pos')
tmp
tmp[44,]
tmp[44, 'chr']
tmp <- unnest_longer(as_tibble(gene_coord), col = 'genomic_pos')
tmp <- unnest_wider(as_tibble(gene_coord), col = 'genomic_pos')
tmp
tmp[44,]
tmp <- unnest(as_tibble(gene_coord), col = 'genomic_pos')
tmp
tmp %>% tail()
gene_coord2 <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos"), species="human")
gene_coord2
tmp <- unnest(as_tibble(gene_coord2), col = 'genomic_pos')
tmp
tmp %>% tail()
?proteinToGenome
??proteinToGenome
BiocManager::install("ensembldb")
?proteinToGenome
library(ensembldb)
?proteinToGenome
exposure_df[1,]
proteinToGenome(IRanges(names='ENSP00000330393'))
proteinToGenome(IRanges(names=c('ENSP00000330393')))
?IRanges
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'))
prot_name_uniprot_mapping %>% head()
read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'), skip=2) %>% head()
read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'), skip=3) %>% head()
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/')) %>%
dplyr::select(X.2, X.3) %>%
dplyr::rename(protein_name = X.2, uniprot_id = X.3)
head(prot_name_uniprot_mapping)
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/')) %>%
dplyr::select(X.2, X.3) %>%
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'), skip = 3) %>%
dplyr::select(X.2, X.3) %>%
dplyr::rename(protein_name = X.2, uniprot_id = X.3)
head(prot_name_uniprot_mapping)
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'), skip = 3) %>%
dplyr::select(X.2, X.3) %>%
dplyr::rename(protein_name = X.2, uniprot_id = X.3) %>%
distinct()
head(prot_name_uniprot_mapping)
View(prot_name_uniprot_mapping)
queryMany(c('P48357'), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
queryMany(c('P48357'), scopes=c("uniprot"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
# ao <- available_outcomes()
# write.csv(ao, file='/home/dkolobok/code/MR/data/mr_available_outcomes.csv')
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% dplyr::filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
outcome_df <- ao %>% dplyr::filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis')) %>%
dplyr::rename(protein_name = trait)
exposure_df <- ao %>% filter(stringr::str_detect(id, 'prot-')) %>%
dplyr::rename(protein_name = trait)
exposure_df <- ao %>% dplyr::filter(stringr::str_detect(id, 'prot-')) %>%
dplyr::rename(protein_name = trait)
exposure_df <- ao %>% dplyr::filter(stringr::str_detect(id, 'prot-')) %>%
dplyr::rename(protein_name = trait)
prot_name_uniprot_mapping <- read.csv(paste(data_folder, 'protein_name_uniprot_mapping.csv', sep='/'), skip = 3) %>%
dplyr::select(X.2, X.3) %>%
dplyr::rename(protein_name = X.2, uniprot_id = X.3) %>%
distinct()
nrow(exposure_df)
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='protein_name')
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(prot_name_uniprot_mapping, by='protein_name')
nrow(exposure_df)
nrow(prot_name_uniprot_mapping)
library(glue)
library(tidyverse)
library(purrrlyr)
library(mygene)
library(purrr)
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% dplyr::filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(trait = annotation)
exposure_df <- ao %>% dplyr::filter(stringr::str_detect(id, 'prot-')) %>%
dplyr::rename(protein_name = trait)
string_db <- string_db %>% dplyr::rename(protein_name = annotation)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(protein_name = annotation)
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='protein_name')
nrow(exposure_df)
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord
gene_coord %>% head(10)
gene_coord %>% dmap(unlist)
as.data.frame(lapply(gene_coord, unlist))
gene_coord %>% map(unlist) %>% as_data_frame()
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>% as_tibble()
gene_coord %>% dmap(unlist)
gene_coord[1,]
gene_coord[44,]
? queryMany
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human", return.as = 'records')
gene_coord
gene_coord %>% unnest_auto()
gene_coord %>% unnest_longer()
gene_coord %>% unnest_wider()
gene_coord %>% flatten_df()
gene_coord %>% flatten_df(.id='var')
? flatten_df
gene_coord %>% map_df()
gene_coord %>% map_df(~bind_rows(.x, .id = 'var2'), .id = 'var1')
do.call(rbind, do.call(c, gene_coord))
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human", return.as = 'records')
exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord[1,]
gene_coord$genomic_pos %>% as.character()
gene_coord$genomic_pos %>% unlist()
gene_coord$genomic_pos %>% unnest()
gene_coord %>% dplyr::select(genomic_pos) %>% unnest()
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>%
as_tibble()
gene_coord %>% dplyr::select(genomic_pos) %>% unnest()
?queryMany
queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr"), species="human")
queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.start"), species="human")
queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human")
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human") %>%
as_tibble()
gene_coord
gene_coord %>% tail()
gene_coord <- queryMany(exposure_df$protein_external_id %>% unique() %>% head(44), scopes=c("ensembl.protein"),
fields=c("genomic_pos.chr", "genomic_pos.start", "genomic_pos.end"), species="human", returnall=FALSE) %>%
as_tibble()
gene_coord %>% tail()
library(glue)
library(tidyverse)
library(purrrlyr)
library(mygene)
library(purrr)
data_folder <- '/home/dkolobok/code/MR/data'
ao <- read.csv(paste(data_folder, 'mr_available_outcomes.csv', sep='/'))
outcome_df <- ao %>% dplyr::filter(stringr::str_detect(trait, 'pneumon|covid|septicemia|sepsis'))
# the original string database table can be processed by
# sed 's/;.*//; s/9606.//' 9606.protein.info.v11.0.txt > stringdb.txt
# (delete everything after ; and delete '9606.' prefix)
string_db <- read.csv(paste(data_folder, 'stringdb.txt', sep='/'), sep='\t')
string_db <- string_db %>% dplyr::rename(protein_name = annotation)
exposure_df <- ao %>% dplyr::filter(stringr::str_detect(id, 'prot-')) %>%
dplyr::rename(protein_name = trait)
# finds 3032 out of 4489 proteins
exposure_df <- exposure_df %>% inner_join(string_db, by='protein_name')
exposure_df$protein_external_id
nrow(string_db)
exposure_df %>% dplyr::select(protein_external_id) %>% distinct() %>%
write.csv(paste(data_folder, 'ensp.csv', sep='/'), row.names = FALSE)
